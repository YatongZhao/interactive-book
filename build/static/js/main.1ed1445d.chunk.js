(this["webpackJsonpinteractive-book"]=this["webpackJsonpinteractive-book"]||[]).push([[0],{113:function(e,t,n){"use strict";n.r(t);var c=n(2),i=n(0),a=n(11),s=n.n(a),r=n(40),o=n(14),j=n(10),u=n(143),l=n(175),b=n(171),d=n(145),h=n(147),O=n(44),f=n(148),x=n(149),p=n(151),g=n(152),m=n(153),v=n(150),C=n(172),S={apiHost:"",phoneRegExp:/^1[3|4|5|7|8][0-9]{9}$/,passwordRegExp:/(?=.*([a-zA-Z].*))(?=.*[0-9].*)[a-zA-Z0-9-*/+.~!@#$%^&*()]{6,20}$/,nickRegExp:/^\S{4,20}$/},y=Object(i.createContext)({}),k=y.Provider,I=Object(u.a)((function(e){return Object(l.a)({title:{flexGrow:1}})})),w=function(){var e=I(),t=Object(i.useState)([]),n=Object(j.a)(t,2),a=n[0],s=n[1],r=Object(o.e)(),u=Object(i.useContext)(y);return Object(i.useEffect)((function(){fetch("".concat(S.apiHost,"/api/book"),{method:"get"}).then((function(e){return e.json()})).then((function(e){s(e.books)}))}),[]),Object(c.jsxs)(b.a,{children:[Object(c.jsx)(d.a,{position:"sticky",color:"primary",children:Object(c.jsxs)(h.a,{variant:"dense",children:[Object(c.jsx)(O.a,{variant:"h6",className:e.title,children:"ZBOOK"}),Object(c.jsx)(C.a,{children:function(){return Object(c.jsx)(c.Fragment,{children:u.isIsLoginReady?Object(c.jsx)(c.Fragment,{children:u.isLogin?Object(c.jsx)(f.a,{in:u.isLogin,children:Object(c.jsx)(b.a,{children:u.userInfo.nick})}):Object(c.jsx)(f.a,{in:!u.isLogin,children:Object(c.jsx)(x.a,{color:"inherit",onClick:function(){return r.push("/login")},children:"Login"})})}):Object(c.jsx)(v.a,{animation:"wave",width:60})})}})]})}),Object(c.jsx)(p.a,{children:a.map((function(e){return Object(c.jsx)(g.a,{button:!0,onClick:function(){return t=e.id,void r.push("/book/".concat(t));var t},children:Object(c.jsx)(m.a,{primary:e.title})},e.id)}))})]})},L=n(156),N=n(166),T=n(176),E=n(157),B=n(158),F=n(159),W=n(170),z=n(162),M=n(70),R=n(160),H=n(161),P=n(177),J=n(163),U=n(173),$=n(57),A=n(58),Z=n(13),D=n(69);console.log(Object(D.v4)());var G=function(){function e(t){Object($.a)(this,e),this.title="",this.author="",this.content="",this.sub=[],this.subMap={},this.id="",this.initialized=!1,t&&this.initialize(t),Object(Z.d)(this,{initialized:Z.e,id:Z.e,title:Z.e,author:Z.e,content:Z.e,sub:Z.e,subMap:Z.e,addSub:Z.b,addSubMap:Z.b,initialize:Z.b})}return Object(A.a)(e,[{key:"initialize",value:function(e){this.id=e.id||Object(D.v4)(),this.title=e.title,this.author=e.author,this.content=e.content,this.sub=e.sub||[],this.initialized=!0}},{key:"addSub",value:function(t){this.sub.push({id:t.id,title:t.title,author:t.author}),this.addSubMap(new e(t))}},{key:"addSubMap",value:function(e){this.subMap[e.id]=e}}]),e}(),K=n(154),q=n(155),Q=Object(u.a)((function(e){return Object(l.a)({container:{marginTop:e.spacing(2)}})})),V=function(e){var t=e.data,n=e.onSelect,i=e.selectId,a=Q();return Object(c.jsx)(b.a,{className:a.container,children:Object(c.jsx)(p.a,{subheader:Object(c.jsx)(K.a,{disableSticky:!0,children:"\u89c9\u5f97\u672c\u7ae0\u770b\u7684\u4e0d\u8fc7\u763e\uff1f\u770b\u770b\u5176\u4ed6\u540c\u6837\u4f18\u79c0\u7684\u7248\u672c\u5427\uff1a"}),children:t.sub.map((function(e){return Object(c.jsxs)(g.a,{button:!0,onClick:function(){return n(e.id)},children:[Object(c.jsx)(q.a,{children:Object(c.jsx)(U.a,{checked:e.id===i})}),Object(c.jsx)(m.a,{primary:e.title})]},e.id)}))})})},X=function(e){var t=e.data,n=Object(i.useState)(!1),a=Object(j.a)(n,2),s=a[0],r=a[1],o=Object(i.useState)(""),u=Object(j.a)(o,2),l=u[0],b=u[1],d=Object(i.useState)(""),h=Object(j.a)(d,2),O=h[0],f=h[1],p=Object(i.useState)(""),g=Object(j.a)(p,2),m=g[0],v=g[1],C=function(){return r(!1)};return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(x.a,{variant:"contained",color:"default",disableElevation:!0,size:"small",onClick:function(){return r(!0)},children:"\u5728\u5f53\u524d\u4f4d\u7f6e\u6dfb\u52a0\u4e00\u4e2a\u7ae0\u8282"}),Object(c.jsxs)(T.a,{onClose:C,open:s,children:[Object(c.jsx)(E.a,{children:"\u6dfb\u52a0\u4e00\u4e2a\u7ae0\u8282"}),Object(c.jsxs)(B.a,{children:[Object(c.jsx)(F.a,{children:"\u5728\u5f53\u524d\u4f4d\u7f6e\uff0c\u6dfb\u52a0\u4e00\u4e2a\u7ae0\u8282\u9009\u62e9"}),Object(c.jsx)(W.a,{autoFocus:!0,value:l,onChange:function(e){return b(e.target.value)},label:"\u6807\u9898",fullWidth:!0}),Object(c.jsx)(W.a,{autoFocus:!0,value:O,onChange:function(e){return f(e.target.value)},label:"\u4f5c\u8005",fullWidth:!0}),Object(c.jsx)(W.a,{autoFocus:!0,value:m,onChange:function(e){return v(e.target.value)},label:"\u5185\u5bb9",fullWidth:!0,multiline:!0,rowsMax:10})]}),Object(c.jsxs)(z.a,{children:[Object(c.jsx)(x.a,{onClick:function(){fetch("".concat(S.apiHost,"/api/chapter"),{method:"post",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:l,author:O,content:m,parentId:t.id})}).then((function(e){return e.json()})).then((function(e){t.addSub({title:l,author:O,content:m,id:e.id}),r(!1)}))},color:"primary",children:"\u786e\u5b9a"}),Object(c.jsx)(x.a,{onClick:C,color:"primary",children:"\u53d6\u6d88"})]})]})]})},Y=Object(u.a)((function(e){return Object(l.a)({title:{marginTop:e.spacing(8),width:"100%",alignItems:"flex-start",flexDirection:"column"},author:{fontWeight:400,color:e.palette.grey[400],fontSize:e.spacing(2),textAlign:"right",width:"100%",marginTop:e.spacing(1)},content:{marginTop:e.spacing(6),textIndent:e.spacing(4),lineHeight:e.spacing(.22)},selectorContainer:{paddingLeft:e.spacing(3),marginTop:e.spacing(2),marginBottom:e.spacing(2)}})})),_=function e(t){var n=t.data,a=t.parent,s=t.setParentId,r=Y(),o=Object(i.useState)(""),u=Object(j.a)(o,2),l=u[0],d=u[1],h=Object(i.useState)(null),f=Object(j.a)(h,2),x=f[0],p=f[1],g=Object(i.useState)(!1),m=Object(j.a)(g,2),v=m[0],y=m[1],k=function(e){d(e.target.value),y(!1)};return Object(i.useEffect)((function(){0!==n.sub.length&&d(n.sub[0].id)}),[n]),Object(i.useEffect)((function(){l&&(n.subMap[l]?p(n.subMap[l]):fetch("".concat(S.apiHost,"/api/chapter/").concat(l),{method:"get"}).then((function(e){return e.json()})).then((function(e){var t=e.chapter,c=new G(t);p(c),n.addSubMap(c)})))}),[l,n]),Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(b.a,{className:r.content,children:n.content}),a&&Object(c.jsx)(V,{data:a,onSelect:function(e){s&&s(e)},selectId:n.id}),x&&Object(c.jsx)(c.Fragment,{children:Object(c.jsxs)(M.a,{className:r.title,onClick:function(){return y(!v)},children:[Object(c.jsx)(O.a,{variant:"h4",children:x.title}),Object(c.jsxs)(b.a,{className:r.author,children:["author: ",x.author]})]})}),Object(c.jsx)(C.a,{children:function(){return Object(c.jsx)(c.Fragment,{children:(!l||v)&&Object(c.jsxs)(b.a,{className:r.selectorContainer,children:[0!==n.sub.length&&Object(c.jsxs)(R.a,{component:"fieldset",fullWidth:!0,children:[Object(c.jsx)(H.a,{component:"legend",children:"\u9009\u62e9\u4e00\u6761\u5206\u652f"}),Object(c.jsx)(P.a,{value:l,onChange:k,children:n.sub.map((function(e){return Object(c.jsx)(J.a,{value:e.id,control:Object(c.jsx)(U.a,{size:"small"}),label:e.title},e.id)}))})]}),Object(c.jsx)(X,{data:n})]})})}}),Object(c.jsx)(C.a,{children:function(){return Object(c.jsx)(c.Fragment,{children:x&&Object(c.jsx)(e,{data:x,parent:n,setParentId:d},x.id)})}})]})},ee=n(164),te=n(165),ne=function(e){var t=e.children,n=Object(ee.a)();return Object(c.jsx)(te.a,{appear:!1,direction:"down",in:!n,children:t})},ce=n(61),ie=n.n(ce),ae=Object(u.a)((function(e){return Object(l.a)({title:{flexGrow:1},container:{marginTop:e.spacing(3)},menuButton:{marginRight:e.spacing(2)}})})),se=function(){var e=ae(),t=Object(o.f)().id,n=Object(i.useState)(null),a=Object(j.a)(n,2),s=a[0],r=a[1],u=Object(o.e)();return Object(i.useEffect)((function(){fetch("".concat(S.apiHost,"/api/chapter/").concat(t),{method:"get"}).then((function(e){return e.json()})).then((function(e){r(new G(e.chapter))}))}),[t]),Object(c.jsxs)(b.a,{children:[Object(c.jsx)(ne,{children:Object(c.jsx)(d.a,{position:"sticky",color:"default",children:Object(c.jsxs)(h.a,{variant:"dense",children:[Object(c.jsx)(L.a,{onClick:function(){return u.goBack()},edge:"start",className:e.menuButton,color:"inherit",children:Object(c.jsx)(ie.a,{})}),Object(c.jsx)(O.a,{variant:"h6",className:e.title,children:s?Object(c.jsx)(f.a,{in:!!s,children:Object(c.jsx)(b.a,{children:s.title})}):Object(c.jsx)(v.a,{animation:"wave",width:100})})]})})}),Object(c.jsx)(N.a,{className:e.container,children:Object(c.jsx)(C.a,{children:function(){return Object(c.jsx)(c.Fragment,{children:s?s.initialized?Object(c.jsx)(_,{data:s}):Object(c.jsx)(b.a,{children:"error"}):Object(c.jsx)(b.a,{children:"waiting..."})})}})})]})},re=n(167),oe=n(168),je=function(){var e=Object(o.e)();return Object(c.jsx)(d.a,{position:"sticky",color:"inherit",elevation:0,children:Object(c.jsx)(h.a,{variant:"dense",children:Object(c.jsx)(L.a,{onClick:function(){return e.goBack()},edge:"start",color:"inherit",children:Object(c.jsx)(ie.a,{})})})})},ue=Object(u.a)((function(e){return Object(l.a)({container:{margin:"".concat(e.spacing(4),"px auto"),maxWidth:e.spacing(40)},submitBtnContainer:{position:"relative"},submitBtn:{marginTop:e.spacing(1)},buttonProgress:{position:"absolute",top:"50%",left:"50%",marginTop:-10,marginLeft:-12},signInBox:{display:"flex",justifyContent:"center"}})})),le=function(){var e=Object(o.e)(),t=Object(i.useState)(""),n=Object(j.a)(t,2),a=n[0],s=n[1],u=Object(i.useState)(!1),l=Object(j.a)(u,2),d=l[0],h=l[1],f=Object(i.useState)(""),p=Object(j.a)(f,2),g=p[0],m=p[1],v=Object(i.useState)(""),C=Object(j.a)(v,2),k=C[0],I=C[1],w=Object(i.useState)(!1),L=Object(j.a)(w,2),N=L[0],T=L[1],E=Object(i.useState)(""),B=Object(j.a)(E,2),F=B[0],z=B[1],M=Object(i.useState)(!1),R=Object(j.a)(M,2),H=R[0],P=R[1],J=Object(i.useContext)(y),U=ue();return Object(i.useEffect)((function(){m(""),h(!1)}),[a]),Object(i.useEffect)((function(){z(""),T(!1)}),[k]),Object(c.jsxs)(b.a,{children:[Object(c.jsx)(je,{}),Object(c.jsxs)(re.a,{container:!0,className:U.container,spacing:4,children:[Object(c.jsx)(re.a,{item:!0,xs:12,children:Object(c.jsx)(W.a,{autoFocus:!0,error:d,helperText:g,value:a,onChange:function(e){return s(e.target.value)},label:"\u624b\u673a",type:"number",fullWidth:!0})}),Object(c.jsx)(re.a,{item:!0,xs:12,children:Object(c.jsx)(W.a,{error:N,helperText:F,value:k,type:"password",onChange:function(e){return I(e.target.value)},label:"\u5bc6\u7801",fullWidth:!0})}),Object(c.jsxs)(re.a,{item:!0,xs:12,className:U.submitBtnContainer,children:[Object(c.jsx)(x.a,{disabled:H,onClick:function(){if(!d&&!N){if(!a)return m("\u8bf7\u8f93\u5165\u624b\u673a\u53f7"),void h(!0);if(!S.phoneRegExp.test(a))return m("\u8bf7\u8f93\u5165\u6b63\u786e\u624b\u673a\u53f7"),void h(!0);P(!0),fetch("".concat(S.apiHost,"/api/user/sign-in"),{method:"post",mode:"cors",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:a,password:k})}).then((function(e){return e.json()})).then((function(t){if(P(!1),!t.errCode)return e.goBack(),J.setIsLogin(!0),void J.setUserInfo(t.info);1===t.errCode?(m(t.errMsg),h(!0)):2===t.errCode&&(z(t.errMsg),T(!0))}))}},className:U.submitBtn,variant:"outlined",color:"primary",fullWidth:!0,children:"\u767b\u5f55"}),H&&Object(c.jsx)(oe.a,{size:24,className:U.buttonProgress})]}),Object(c.jsx)(re.a,{item:!0,xs:12,className:U.signInBox,children:Object(c.jsxs)(O.a,{variant:"caption",children:["\u8fd8\u6ca1\u6709\u8d26\u53f7\uff0c\u7acb\u5373\u524d\u5f80",Object(c.jsx)(r.b,{to:"/sign-up",children:"\u6ce8\u518c"})]})})]})]})},be=Object(u.a)((function(e){return Object(l.a)({container:{margin:"".concat(e.spacing(4),"px auto"),maxWidth:e.spacing(40)},submitBtnContainer:{position:"relative"},submitBtn:{marginTop:e.spacing(1)},buttonProgress:{position:"absolute",top:"50%",left:"50%",marginTop:-10,marginLeft:-12}})})),de=function(){var e=Object(o.e)(),t=Object(i.useState)(""),n=Object(j.a)(t,2),a=n[0],s=n[1],r=Object(i.useState)(!1),u=Object(j.a)(r,2),l=u[0],d=u[1],h=Object(i.useState)(""),O=Object(j.a)(h,2),f=O[0],p=O[1],g=Object(i.useState)(""),m=Object(j.a)(g,2),v=m[0],C=m[1],k=Object(i.useState)(!1),I=Object(j.a)(k,2),w=I[0],L=I[1],N=Object(i.useState)(""),T=Object(j.a)(N,2),E=T[0],B=T[1],F=Object(i.useState)(""),z=Object(j.a)(F,2),M=z[0],R=z[1],H=Object(i.useState)(!1),P=Object(j.a)(H,2),J=P[0],U=P[1],$=Object(i.useState)(""),A=Object(j.a)($,2),Z=A[0],D=A[1],G=Object(i.useState)(""),K=Object(j.a)(G,2),q=K[0],Q=K[1],V=Object(i.useState)(!1),X=Object(j.a)(V,2),Y=X[0],_=X[1],ee=Object(i.useState)(""),te=Object(j.a)(ee,2),ne=te[0],ce=te[1],ie=Object(i.useState)(!1),ae=Object(j.a)(ie,2),se=ae[0],ue=ae[1],le=Object(i.useContext)(y),de=be();return Object(i.useEffect)((function(){p(""),d(!1)}),[a]),Object(i.useEffect)((function(){B(""),L(!1)}),[v]),Object(i.useEffect)((function(){D(""),U(!1)}),[M]),Object(i.useEffect)((function(){ce(""),_(!1)}),[q]),Object(c.jsxs)(b.a,{children:[Object(c.jsx)(je,{}),Object(c.jsxs)(re.a,{container:!0,className:de.container,spacing:4,children:[Object(c.jsx)(re.a,{item:!0,xs:12,children:Object(c.jsx)(W.a,{autoFocus:!0,error:l,helperText:f,value:a,onChange:function(e){return s(e.target.value)},label:"\u6635\u79f0",fullWidth:!0})}),Object(c.jsx)(re.a,{item:!0,xs:12,children:Object(c.jsx)(W.a,{error:w,helperText:E,value:v,onChange:function(e){return C(e.target.value)},label:"\u624b\u673a",type:"number",fullWidth:!0})}),Object(c.jsx)(re.a,{item:!0,xs:12,children:Object(c.jsx)(W.a,{error:J,helperText:Z,value:M,type:"password",onChange:function(e){return R(e.target.value)},label:"\u5bc6\u7801",fullWidth:!0})}),Object(c.jsx)(re.a,{item:!0,xs:12,children:Object(c.jsx)(W.a,{error:Y,helperText:ne,value:q,type:"password",onChange:function(e){return Q(e.target.value)},label:"\u786e\u8ba4\u5bc6\u7801",fullWidth:!0})}),Object(c.jsxs)(re.a,{item:!0,xs:12,className:de.submitBtnContainer,children:[Object(c.jsx)(x.a,{disabled:se,onClick:function(){return v?S.phoneRegExp.test(v)?a?S.nickRegExp.test(a)?M?S.passwordRegExp.test(M)?q?M!==q?(ce("\u4e24\u6b21\u8f93\u5165\u5bc6\u7801\u4e0d\u76f8\u540c"),_(!0),void U(!0)):(ue(!0),void fetch("".concat(S.apiHost,"/api/user/sign-up"),{method:"post",mode:"cors",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:v,password:M,nick:a})}).then((function(e){return e.json()})).then((function(t){if(ue(!1),!t.errCode)return le.setIsLogin(!0),le.setUserInfo(t.info),void e.push("/");4===t.errCode?(B("\u8be5\u624b\u673a\u53f7\u5df2\u88ab\u6ce8\u518c"),L(!0)):5===t.errCode&&(p("\u8be5\u6635\u79f0\u5df2\u5b58\u5728"),d(!0))}))):(ce("\u8bf7\u8f93\u5165\u4e8c\u6b21\u786e\u8ba4\u5bc6\u7801"),void _(!0)):(D("\u5bc6\u7801\u683c\u5f0f\u4e0d\u6b63\u786e"),void U(!0)):(D("\u8bf7\u8bbe\u7f6e\u5bc6\u7801"),void U(!0)):(p("\u6635\u79f0\u683c\u5f0f\u4e0d\u7b26\u5408\u8981\u6c42"),void d(!0)):(p("\u8bf7\u8f93\u5165\u6635\u79f0"),void d(!0)):(B("\u8bf7\u8f93\u5165\u6b63\u786e\u624b\u673a\u53f7"),void L(!0)):(B("\u8bf7\u8f93\u5165\u624b\u673a\u53f7"),void L(!0))},className:de.submitBtn,variant:"outlined",color:"primary",fullWidth:!0,children:"\u6ce8\u518c"}),se&&Object(c.jsx)(oe.a,{size:24,className:de.buttonProgress})]})]})]})},he=function(){var e=Object(i.useContext)(y);return Object(i.useEffect)((function(){fetch("".concat(S.apiHost,"/api/user/info"),{method:"get",credentials:"include"}).then((function(e){return e.json()})).then((function(t){1e3===t.errCode?e.setIsLogin(!1):(e.setIsLogin(!0),e.setUserInfo(t.info))}))}),[e]),Object(c.jsxs)(r.a,{children:[Object(c.jsx)(o.a,{path:"/",exact:!0,children:Object(c.jsx)(w,{})}),Object(c.jsx)(o.a,{path:"/book/:id",children:Object(c.jsx)(se,{})}),Object(c.jsx)(o.a,{path:"/login",children:Object(c.jsx)(le,{})}),Object(c.jsx)(o.a,{path:"/sign-up",children:Object(c.jsx)(de,{})})]})},Oe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,179)).then((function(t){var n=t.getCLS,c=t.getFID,i=t.getFCP,a=t.getLCP,s=t.getTTFB;n(e),c(e),i(e),a(e),s(e)}))},fe=n(169),xe=new(function(){function e(){Object($.a)(this,e),this.isLogin=!1,this.isIsLoginReady=!1,this.userInfo={phone:"",nick:"",id:""},Object(Z.d)(this,{isLogin:Z.e,isIsLoginReady:Z.e,setIsLogin:Z.b,setUserInfo:Z.b})}return Object(A.a)(e,[{key:"setIsLogin",value:function(e){this.isLogin=e,this.isIsLoginReady=!0}},{key:"setUserInfo",value:function(e){this.userInfo=e}}]),e}());s.a.render(Object(c.jsxs)(k,{value:xe,children:[Object(c.jsx)(fe.a,{}),Object(c.jsx)(he,{})]}),document.getElementById("root")),Oe()}},[[113,1,2]]]);
//# sourceMappingURL=main.1ed1445d.chunk.js.map